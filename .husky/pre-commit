#!/bin/sh

# Fast pre-commit hook: Format and auto-fix staged TypeScript files
# Silent mode - only shows errors if something fails

STAGED_TS=$(git diff --cached --name-only --diff-filter=ACM -- '*.ts' | grep -v '\.test\.ts$' | grep -v '\.spec\.ts$')

[ -z "$STAGED_TS" ] && exit 0

# Format and auto-fix (silent, only errors shown)
echo "$STAGED_TS" | xargs bunx prettier --write --log-level=error >/dev/null 2>&1 && \
echo "$STAGED_TS" | xargs git add >/dev/null 2>&1 && \
echo "$STAGED_TS" | xargs bunx eslint --fix --quiet --max-warnings=999999 >/dev/null 2>&1 && \
echo "$STAGED_TS" | xargs git add >/dev/null 2>&1

# Exit success (warnings don't block commits)
exit 0
